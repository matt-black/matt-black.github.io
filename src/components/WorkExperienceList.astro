---
import { getCollection } from "astro:content";

const workEntries = await getCollection("work");

// Sort by start date, most recent first
const sortedWork = workEntries.sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime()
);

function formatPeriod(startDate: Date, endDate?: Date) {
  const options: Intl.DateTimeFormatOptions = {
    month: "short",
    year: "numeric",
  };
  const start = startDate.toLocaleDateString("en-US", options);
  const end = endDate
    ? endDate.toLocaleDateString("en-US", options)
    : "Present";
  return `${start} - ${end}`;
}
---

<section id="work" class="py-20 px-4 bg-base-200">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-4xl font-bold mb-12 text-center">Work Experience</h2>

    <ul class="list bg-base-100 rounded-box shadow-lg">
      {
        sortedWork.map((work, index) => (
          <li class="border-b hover:opacity-85 transition-opacity border-base-300 last:border-b-0">
            <details class="collapse">
              <summary class="collapse-title pe-5">
                <div class="list-row p-0 items-center after:hidden">
                  <div>
                    {work.data.logo && (
                      <img
                        class="size-10 rounded-box"
                        src={work.data.logo}
                        alt={work.data.company}
                      />
                    )}
                  </div>

                  <div>
                    <h3 class="font-bold text-lg">{work.data.company}</h3>
                    <p class="text-primary font-semibold text-sm">
                      {work.data.position}
                    </p>
                  </div>

                  <div class="text-sm text-base-content/70 font-mono whitespace-nowrap">
                    {formatPeriod(work.data.startDate, work.data.endDate)}
                  </div>
                </div>
              </summary>

              <div class="collapse-content">
                <p class="text-base-content/80">{work.data.description}</p>
                {work.data.link && (
                  <div class="flex justify-end">
                    <a
                      href={work.data.link}
                      target="_blank"
                      class="link link-hover"
                    >
                      View Company
                    </a>
                  </div>
                )}
              </div>
            </details>
          </li>
        ))
      }
    </ul>
  </div>
</section>
