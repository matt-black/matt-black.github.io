---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

const workEntries = await getCollection("work");

// Sort by start date, most recent first
const sortedWork = workEntries.sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime()
);

function formatPeriod(startDate: Date, endDate?: Date) {
  const options: Intl.DateTimeFormatOptions = {
    month: "short",
    year: "numeric",
  };
  const start = startDate.toLocaleDateString("en-US", options);
  const end = endDate
    ? endDate.toLocaleDateString("en-US", options)
    : "Present";
  return `${start} - ${end}`;
}
---

<section id="work" class="py-20 px-4 bg-base-200">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-4xl font-bold mb-12 text-center">Work Experience</h2>

    <ul class="timeline timeline-vertical timeline-snap-icon">
      {
        sortedWork.map((work, index) => (
          <li>
            {index > 0 && <hr class="bg-primary-content" />}
            <div class="timeline-middle">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 20 20"
                fill="currentColor"
                class="w-5 h-5 fill-primary"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div
              class={`timeline-${index % 2 === 0 ? "start" : "end"} pt-2 mb-10`}
            >
              <time
                class={`font-mono text-sm text-base-content/70 block italic ${index % 2 === 0 ? "text-end pr-1" : "pl-1"}`}
              >
                {formatPeriod(work.data.startDate, work.data.endDate)}
              </time>
              <div class="card bg-base-100 shadow-xl mt-2">
                <div class="card-body">
                  <div class="flex items-center gap-4 mb-2">
                    {work.data.logo && (
                      <div class="avatar">
                        <div class="w-12 rounded">
                          <img src={work.data.logo} alt={work.data.company} />
                        </div>
                      </div>
                    )}
                    <div>
                      <h3 class="card-title">{work.data.company}</h3>
                      <p class="text-primary font-semibold">
                        {work.data.position}
                      </p>
                    </div>
                  </div>
                  <p class="text-base-content/80">{work.data.description}</p>
                  {work.data.link && (
                    <div class="card-actions justify-end mt-4">
                      <a
                        href={work.data.link}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="link link-hover"
                      >
                        View Company
                      </a>
                    </div>
                  )}
                </div>
              </div>
            </div>
            {index < sortedWork.length - 1 && <hr class="bg-primary-content" />}
          </li>
        ))
      }
    </ul>
  </div>
</section>
